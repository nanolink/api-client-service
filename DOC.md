<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [README][1]
*   [App][2]
    *   [Parameters][3]
    *   [onReady][4]
        *   [Parameters][5]
    *   [onMirrorCreated][6]
        *   [Parameters][7]
*   [AppBase][8]
    *   [Parameters][9]
    *   [url][10]
    *   [apitoken][11]
    *   [connection][12]
    *   [db][13]
    *   [run][14]
    *   [callbackTo][15]
        *   [Parameters][16]
    *   [onReady][17]
        *   [Parameters][18]
    *   [onLogReady][19]
    *   [onMirrorCreated][20]
        *   [Parameters][21]
*   [VolageRanges][22]
*   [Ignition][23]
    *   [Parameters][24]
*   [ExampleApp][25]
    *   [Parameters][26]
    *   [db][27]
    *   [references][28]
    *   [trackers][29]
    *   [vid2objectid][30]
    *   [callbackTo][31]
        *   [Parameters][32]
    *   [run][33]
    *   [onMirrorCreated][34]
        *   [Parameters][35]
        *   [Examples][36]
    *   [onLogReady][37]
    *   [onReady][38]
        *   [Examples][39]
    *   [getCommittedVersion][40]
        *   [Parameters][41]
    *   [getCommittedObjectId][42]
        *   [Parameters][43]
    *   [commitVersion][44]
        *   [Parameters][45]
    *   [onReferenceAdded][46]
        *   [Parameters][47]
    *   [onReferenceUpdated][48]
        *   [Parameters][49]
    *   [onReferenceDeleted][50]
        *   [Parameters][51]
    *   [onTrackerAdded][52]
        *   [Parameters][53]
    *   [onTrackerUpdated][54]
        *   [Parameters][55]
    *   [onTrackerDeleted][56]
        *   [Parameters][57]
    *   [onGPSDataUpdate][58]
        *   [Parameters][59]
    *   [onGPSLogReceived][60]
        *   [Parameters][61]
    *   [onTransmitterLinkUpdate][62]
        *   [Parameters][63]
    *   [trackerIgnitionState][64]
    *   [onVoltageChanged][65]
        *   [Parameters][66]
    *   [onIgnitionChanged][67]
        *   [Parameters][68]
    *   [onBatteryPercentChanged][69]
        *   [Parameters][70]
    *   [onTripReceived][71]
        *   [Parameters][72]
    *   [onWorkHoursReceived][73]
        *   [Parameters][74]
    *   [onTagPositionReceived][75]
        *   [Parameters][76]

## README

# api-client-service

A node project which uses Nanolink api's for mirroring data, using NL's graphQL subscriptions.

Clone the project, open it in vscode, change the ENV variables in launch.json accordingly, and hit F5 to run.

You will need at least to change the ENV variables:<br>
CORESERVER<br>
APITOKEN<br>

These two values you can receive from Nanolink support.

## App

**Extends AppBase**

This is main application class called from the index.js
See example.js for reference examples.

### Parameters

*   `url` **any** Url to core server
*   `apitoken` **any** API token

### onReady

Called when connection to coreserver is established

#### Parameters

*   `customer` &#x20;

Returns **any**&#x20;

### onMirrorCreated

Called when a mirror is created. Can be used to setup callbacks on the mirror
to get change events.

#### Parameters

*   `mirror` **Mirror**&#x20;

Returns **any**&#x20;

## AppBase

Base application class

Type: [AppBase][8]

### Parameters

*   `url` **any** Url to nanolink core server
*   `apitoken` **any** API security token

### url

Url to core server given by nanolink

Type: any

### apitoken

API token given by nanolink

Type: any

### connection

Connection handler

Type: any

### db

Level db object

Type: any

### run

Description placeholder

Returns **any**&#x20;

### callbackTo

Call in an object making sure that this is correct

#### Parameters

*   `f` **any**&#x20;

### onReady

Called when connetion for core server is ready

#### Parameters

*   `customer` **any** Customer info object containing customerId and companyName

Returns **any**&#x20;

### onLogReady

Called when connection for

Returns **any**&#x20;

### onMirrorCreated

Called when a mirror is ready and loaded

#### Parameters

*   `mirror` **Mirror** Mirror object

Returns **any**&#x20;

## VolageRanges

Description placeholder

Type: {}

## Ignition

Description placeholder

### Parameters

*   `voltage` **any**&#x20;

Returns **[boolean][77]**&#x20;

## ExampleApp

**Extends AppBase**

The main application class.

### Parameters

*   `url` **any**&#x20;
*   `apitoken` **any**&#x20;

### db

Instance of level db

Type: any

### references

Reference mirror

Type: any

### trackers

Tracker mirror

Type: any

### vid2objectid

vid to objectid map

Type: any

### callbackTo

Make sure that a callback has the correct this

#### Parameters

*   `f` **[function][78]**&#x20;

Returns **any** A function that is applied to "this"

### run

Start the app

Returns **any**&#x20;

### onMirrorCreated

Called whenever a mirror is ready for use

#### Parameters

*   `mirror` **any**&#x20;

#### Examples

```javascript
// So if you want to monitor mirror changes. Implement this callback
if (mirror.name == "references") {
  this.referenceVersion = await this.getCommittedVersion("references");
  mirror.onInserted = this.callbackTo(this.onReferenceAdded);
  mirror.onUpdated = this.callbackTo(this.onReferenceUpdated);
  mirror.onDeleted = this.callbackTo(this.onReferenceDeleted);
} else if (mirror.name == "trackers") {
  this.trackerVersion = await this.getCommittedVersion("trackers");
  mirror.onInserted = this.callbackTo(this.onTrackerAdded);
  mirror.onUpdated = this.callbackTo(this.onTrackerUpdated);
  mirror.onDeleted = this.callbackTo(this.onTrackerDeleted);
}
```

Returns **any**&#x20;

### onLogReady

Called when the log is ready.
Receivers valid for this function are located under: @nanolink/nanolink-tools/lib/logreceivers

Returns **any**&#x20;

### onReady

Main application code. Change this function to your needs.

Mirrors should always be initialized in this function

Receivers valid in this function are located under: @nanolink/nanolink-tools/lib/receivers/

#### Examples

```javascript
// So if you i.e want the information for an reference just use:
// getMirror returns a Map with id as key and the document as value
// Note: the map is kept up-to date with changes from the server
let references = await this.connection.getMirror("references");
let theReference = references.get(referenceId);
let name;
if (theReference.__typename == "QAsset") {
   name = theReference.brand + ' ' + theReference.model;
} else if (theReference.__typename == "QSite") {
   name = theReference.name;
} else if (theReference.__typename == "QUser") {
   name = theReference.fullName;
}

// This piece of code listens for GPS changes on trackers (receivers only)
let gpsReceivers = new GPSReceiver(this.connection);
gpsReceivers.onDataReceived = this.callbackTo(this.onGPSDataUpdate);
gpsReceivers.run(true);
```

Returns **any**&#x20;

### getCommittedVersion

Get a persistet version from leveldb

#### Parameters

*   `mirror` **any**&#x20;

Returns **unknown**&#x20;

### getCommittedObjectId

Get a persisten version as ObjectId from leveldb

#### Parameters

*   `mirror` **any**&#x20;

Returns **unknown**&#x20;

### commitVersion

Commit a version to leveldb (Both int and ObjectId)

#### Parameters

*   `mirror` **any**&#x20;
*   `version` **any**&#x20;

Returns **any**&#x20;

### onReferenceAdded

Called when a reference is added to nanolink system

#### Parameters

*   `mirror` **any**&#x20;
*   `reference` **any**&#x20;

### onReferenceUpdated

Called when a reference is updated in nanolink system

#### Parameters

*   `mirror` **any**&#x20;
*   `reference` **any**&#x20;
*   `_orgReference` **any**&#x20;

### onReferenceDeleted

Called when a reference is deleted in nanolink system

#### Parameters

*   `mirror` **any**&#x20;
*   `reference` **any**&#x20;

### onTrackerAdded

Called when a tracker is added to the nanolink system

#### Parameters

*   `mirror` **any**&#x20;
*   `tracker` **any**&#x20;

### onTrackerUpdated

Called when a tracker is updated in the nanolink system

#### Parameters

*   `mirror` **any**&#x20;
*   `tracker` **any**&#x20;
*   `_orgTracker` **any**&#x20;

### onTrackerDeleted

Called when a tracker is deleted in the nanolink system

#### Parameters

*   `mirror` **any**&#x20;
*   `tracker` **any**&#x20;

### onGPSDataUpdate

Called when a gps is received from nanolink system

#### Parameters

*   `gps` **any**&#x20;

### onGPSLogReceived

Called when a gps log entry is received from nanolink system

#### Parameters

*   `gps` **any**&#x20;

### onTransmitterLinkUpdate

Called when transmitterlink is received from the nanolink system

#### Parameters

*   `tlink` **OTransmitterLink**&#x20;

### trackerIgnitionState

Used to give an example on how to detect ignition from GPS gate using
voltage state

Type: any

### onVoltageChanged

Called when a voltage state is received from nanolink system

#### Parameters

*   `data` **any**&#x20;

### onIgnitionChanged

Called from onVoltageChange to indicate an ignition change

#### Parameters

*   `data` **any**&#x20;
*   `ignition` **any**&#x20;

### onBatteryPercentChanged

Called when battery percent in received from the nanolink system

#### Parameters

*   `data` **any**&#x20;

### onTripReceived

Called when a trip is received from the nanolink system

#### Parameters

*   `data` **any**&#x20;

### onWorkHoursReceived

Called when work hour entry is received from the nanolink system

#### Parameters

*   `data` **any**&#x20;

### onTagPositionReceived

Called when a calculated position on nanolink is received from the nanolink system

#### Parameters

*   `data` **any**&#x20;

[1]: #readme

[2]: #app

[3]: #parameters

[4]: #onready

[5]: #parameters-1

[6]: #onmirrorcreated

[7]: #parameters-2

[8]: #appbase

[9]: #parameters-3

[10]: #url

[11]: #apitoken

[12]: #connection

[13]: #db

[14]: #run

[15]: #callbackto

[16]: #parameters-4

[17]: #onready-1

[18]: #parameters-5

[19]: #onlogready

[20]: #onmirrorcreated-1

[21]: #parameters-6

[22]: #volageranges

[23]: #ignition

[24]: #parameters-7

[25]: #exampleapp

[26]: #parameters-8

[27]: #db-1

[28]: #references

[29]: #trackers

[30]: #vid2objectid

[31]: #callbackto-1

[32]: #parameters-9

[33]: #run-1

[34]: #onmirrorcreated-2

[35]: #parameters-10

[36]: #examples

[37]: #onlogready-1

[38]: #onready-2

[39]: #examples-1

[40]: #getcommittedversion

[41]: #parameters-11

[42]: #getcommittedobjectid

[43]: #parameters-12

[44]: #commitversion

[45]: #parameters-13

[46]: #onreferenceadded

[47]: #parameters-14

[48]: #onreferenceupdated

[49]: #parameters-15

[50]: #onreferencedeleted

[51]: #parameters-16

[52]: #ontrackeradded

[53]: #parameters-17

[54]: #ontrackerupdated

[55]: #parameters-18

[56]: #ontrackerdeleted

[57]: #parameters-19

[58]: #ongpsdataupdate

[59]: #parameters-20

[60]: #ongpslogreceived

[61]: #parameters-21

[62]: #ontransmitterlinkupdate

[63]: #parameters-22

[64]: #trackerignitionstate

[65]: #onvoltagechanged

[66]: #parameters-23

[67]: #onignitionchanged

[68]: #parameters-24

[69]: #onbatterypercentchanged

[70]: #parameters-25

[71]: #ontripreceived

[72]: #parameters-26

[73]: #onworkhoursreceived

[74]: #parameters-27

[75]: #ontagpositionreceived

[76]: #parameters-28

[77]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[78]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function
